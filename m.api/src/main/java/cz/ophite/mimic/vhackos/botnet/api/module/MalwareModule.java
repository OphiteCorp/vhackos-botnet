package cz.ophite.mimic.vhackos.botnet.api.module;

import cz.ophite.mimic.vhackos.botnet.api.IBotnet;
import cz.ophite.mimic.vhackos.botnet.api.module.base.Module;
import cz.ophite.mimic.vhackos.botnet.api.module.base.ModuleHelper;
import cz.ophite.mimic.vhackos.botnet.api.net.response.MalwareKitResponse;
import cz.ophite.mimic.vhackos.botnet.api.opcode.MalwareKitCreateOpcode;
import cz.ophite.mimic.vhackos.botnet.api.opcode.MalwareKitOpcode;
import cz.ophite.mimic.vhackos.botnet.api.opcode.base.Opcode;
import cz.ophite.mimic.vhackos.botnet.shared.injection.Inject;

/**
 * Spravuje malware.
 *
 * @author mimic
 */
@Inject
public final class MalwareModule extends Module {

    protected MalwareModule(IBotnet botnet) {
        super(botnet);
    }

    /**
     * Získá informace o malwarech uživatele.
     */
    public synchronized MalwareKitResponse getMalwareKit() {
        var opcode = new MalwareKitOpcode();
        return createMalwareKitResponse(opcode);
    }

    /**
     * Vytvoří nový malware.
     */
    public synchronized MalwareKitResponse createMalwareKit() {
        var opcode = new MalwareKitCreateOpcode();
        return createMalwareKitResponse(opcode);
    }

    private MalwareKitResponse createMalwareKitResponse(Opcode opcode) {
        var response = sendRequest(opcode);
        var dto = new MalwareKitResponse();

        ModuleHelper.checkResponseIntegrity(response.keySet(), MalwareKitResponse.class);
        ModuleHelper.setField(response, dto, MalwareKitResponse.P_STARTED);
        ModuleHelper.setField(response, dto, MalwareKitResponse.P_BANKLOG_RUNNING);
        ModuleHelper.setField(response, dto, MalwareKitResponse.P_BANKLOG_LEFT);
        ModuleHelper.setField(response, dto, MalwareKitResponse.P_APPLIED);
        ModuleHelper.setField(response, dto, MalwareKitResponse.P_MALWARE_KIT);
        ModuleHelper.setField(response, dto, MalwareKitResponse.P_TASKS_COUNT);
        ModuleHelper.setField(response, dto, MalwareKitResponse.P_MALWARES);
        ModuleHelper.setField(response, dto, MalwareKitResponse.P_TROJAN_BANKLOG);
        ModuleHelper.setField(response, dto, MalwareKitResponse.P_NEXT_EXPLOIT);

        return dto;
    }
}
